<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Dynamic Timer Components with Voice Recorder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Rethink+Sans:wght@400..800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="config">
    <label>
      <input type="checkbox" id="notifyCheckbox" />
      Enable System Notifications
    </label>
    <br />
    <label class="defaultTimeLabel">
      Default Time:
      <input type="text" id="defaultTime" value="5:00" placeholder="Default Time M:SS" />
    </label>
    <div class="btn-container inline-block">
      <button id="addTimerBtn" title="Add A Timer">‚ûï</button>
    </div>
    <div id="voteData">Total Votes: 0</div>
    <button id="resetVotesBtn" title="Reset Votes">Reset Votes</button>

    <div id="mainTimerContainer" class="timer">
      <input type="text" id="timerTitle" class="timer-title" value="Total Time" oninput="updateTimerTitle()" />
      <input type="text" id="mainTimer" class="timer-value" value="10:00" oninput="updateMainTimerFromInput()" />
      <button id="toggleStartPauseBtn" onclick="toggleStartPause()">‚ñ∂Ô∏è</button>
      <button onclick="resetMainTimer()">üîÑ</button>
    </div>
  </div>

  <div id="timerList">
    <!-- Timer components will be added here dynamically -->
  </div>

  <div id="contentDisplayContainer">
    <h2>Content Display</h2>
  </div>


  <div id="counterDisplay">
    Individual: <span id="individualCount">0</span> | 
    Particular: <span id="particularCount">0</span> | 
    Universal: <span id="universalCount">0</span>
  </div>
  <div id="timerList"></div>


  <script src="version.js"></script>
  <script src="main-timer.js"></script>
  

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const timerList = document.getElementById("timerList");
      const addTimerBtn = document.getElementById("addTimerBtn");
      const contentDisplayContainer = document.getElementById("contentDisplayContainer");

      const counters = {
        Individual: 0,
        Particular: 0,
        Universal: 0
      };

      function updateCounterDisplay() {
        document.getElementById("individualCount").innerText = counters.Individual;
        document.getElementById("particularCount").innerText = counters.Particular;
        document.getElementById("universalCount").innerText = counters.Universal;
      }

      addTimerBtn.addEventListener("click", addTimer);

      function createTimerComponent() {
        const timerComponent = document.createElement("div");
        timerComponent.className = "timer";
        timerComponent.innerHTML = `
          <input type="text" placeholder="Timer Title" class="timer-title"/>
          <input type="text" value="2:00" class="timer-value"/>
          <div class="flex-row">
            <button class="start-pause-btn">‚ñ∂Ô∏è</button>
            <button class="reset-initial-btn">‚èèÔ∏è</button>
            <button class="reset-default-btn">‚§µÔ∏è</button>
            <button class="remove-btn">‚ùå</button>
            <button class="content-btn">Content</button>
          </div>
        `;
        timerList.appendChild(timerComponent);

        const contentBtn = timerComponent.querySelector(".content-btn");
        const dropdownMenu = document.createElement("div");
        dropdownMenu.classList.add("dropdown-menu");
        dropdownMenu.innerHTML = `
          <button class="dropdown-item" data-type="Individual">Individual</button>
          <button class="dropdown-item" data-type="Particular">Particular</button>
          <button class="dropdown-item" data-type="Universal">Universal</button>
        `;
        timerComponent.appendChild(dropdownMenu);

        let assignedCategories = new Set();

        contentBtn.addEventListener("click", () => {
          dropdownMenu.classList.toggle("show-dropdown");
        });

        dropdownMenu.addEventListener("click", (e) => {
          const selectedContent = e.target.dataset.type;
          openContentForm(selectedContent, timerComponent, assignedCategories);
        });

        return timerComponent;
      }

      function openContentForm(contentType, timerComponent, assignedCategories) {
        const existingForm = document.getElementById("contentForm");
        if (existingForm) {
          existingForm.remove();
        }

        const formHTML = `
          <div id="contentForm">
            <input type="text" id="topicName" placeholder="Enter Topic Name"/>
            <input type="text" id="topicTime" value="2:00" placeholder="Enter Time (e.g., 2 min)"/>
            <button id="submitContentBtn">Submit</button>
          </div>
        `;

        const contentForm = document.createElement("div");
        contentForm.innerHTML = formHTML;
        document.body.appendChild(contentForm);

        const submitContentBtn = contentForm.querySelector("#submitContentBtn");
        submitContentBtn.addEventListener("click", () => {
          const topicName = document.getElementById("topicName").value;
          const topicTime = document.getElementById("topicTime").value;

          if (topicName && topicTime) {
            addContentSection(contentType, topicName, topicTime);
            assignedCategories.add(contentType);
            counters[contentType]++;
            updateCounterDisplay();
            contentForm.remove();
          }
        });
      }

      function addContentSection(type, title, time) {
        const contentSection = document.createElement("div");
        contentSection.className = "content-section";
        
        let timerRunning = false;
        let timerInterval;
        let currentTime = time; // Save the original time for later use

        contentSection.innerHTML = `
          <strong>${type}:</strong> ${title} - Time: <span class="time-display" contenteditable="true">${time}</span>
          <button class="remove-content-btn">‚ùå</button>
          <button class="play-pause-btn">‚ñ∂Ô∏è</button>
        `;
        
        contentDisplayContainer.appendChild(contentSection);

        const removeContentBtn = contentSection.querySelector(".remove-content-btn");
        removeContentBtn.addEventListener("click", () => {
          contentSection.remove();
          counters[type]--;
          updateCounterDisplay();
        });

        const playPauseBtn = contentSection.querySelector(".play-pause-btn");
        const timeDisplay = contentSection.querySelector(".time-display");

        playPauseBtn.addEventListener("click", () => {
          if (timerRunning) {
            clearInterval(timerInterval);
            playPauseBtn.innerText = "‚ñ∂Ô∏è";
          } else {
            // When starting, get the time from the contenteditable element
            let editedTime = timeDisplay.innerText;
            let [minutes, seconds] = editedTime.split(":").map(Number);

            timerInterval = setInterval(() => {
              if (seconds > 0) {
                seconds--;
              } else if (minutes > 0) {
                minutes--;
                seconds = 59;
              } else {
                clearInterval(timerInterval);
              }
              editedTime = `${minutes}:${seconds < 10 ? "0" + seconds : seconds}`;
              timeDisplay.innerText = editedTime;
            }, 1000);
            playPauseBtn.innerText = "‚è∏Ô∏è";
          }
          timerRunning = !timerRunning;
        });
      }

      function addTimer() {
        createTimerComponent();
      }
    });
  </script>

</body>

</html>
