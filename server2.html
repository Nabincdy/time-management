<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Dynamic Timer Components with Voice Recorder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Rethink+Sans:wght@400..800&display=swap" rel="stylesheet" />
  <!-- <link rel="stylesheet" href="style.css"> -->

  <style>
    .inline-block {
      display: inline-block;
    }

    body {
      font-family: "Rethink Sans", -apple-system, BlinkMacSystemFont, avenir next, avenir, segoe ui, helvetica neue,
        helvetica, Cantarell, Ubuntu, roboto, noto, arial, sans-serif;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
      line-height: 1.67;
      background-color: #e5e7e9;
    }

    input {
      font-size: inherit;
      background-color: transparent;
    }

    .config {
      margin-bottom: 20px;
    }

    #defaultTime {
      font-size: 24px;
      border: none;
      background-color: #f9f9f8;
    }

    #timerList {
      /* display timers in an auto-flowing grid */
      display: contents;
      grid-template-columns: repeat(auto-fit, minmax(496px, max-content));
      grid-auto-rows: auto;
      grid-gap: 12px;
      margin: 20px 0px;
    }

    .timer {
      display: flex;
      flex-direction: row;
      align-items: center;
      background-color: #f9f9f8;
      border-radius: 8px 20px 20px 8px;
      width: max-content;
      margin: 10px 0px;
    }

    .timer-title {
      /* elegant and readable editable title */
      width: 144px;
      font-family: "Rethink Sans", -apple-system, BlinkMacSystemFont, avenir next, avenir, segoe ui, helvetica neue,
        helvetica, Cantarell, Ubuntu, roboto, noto, arial, sans-serif;
      font-optical-sizing: auto;
      font-weight: 500;
      line-height: 1.67;
      font-size: 18px;
      border: none;
      flex-basis: 1;
      margin-left: 16px;
      margin-right: 16px;
    }

    .timer-value {
      width: 80px;
      font-size: 24px;
      border: none;
      margin-right: 8px;
    }

    .timer-value:focus {
      border: initial;
      background-color: yellow;
    }

    .flex-row {
      display: flex;
      flex-direction: row;
    }

    .btn-container {
      padding: 4px;
      border-radius: 20px;
      position: relative;
      margin: 0;
      overflow: auto;
      background: -moz-linear-gradient(top, #aca79b 0%, #fcfbfa 100%);
      background: -webkit-linear-gradient(top, #aca79b 0%, #fcfbfa 100%);
      background: linear-gradient(to bottom, #aca79b 0%, #fcfbfa 100%);
    }

    .btn-container:before {
      content: "";
      display: block;
      clear: both;
      width: calc(100% - 11px);
      box-shadow: inset 0 0 50px #000;
      position: absolute;
      top: 50%;
      left: 50%;
      height: calc(100% - 9px);
      transform: translateX(-50%) translateY(-50%);
      border-radius: 17px;
    }

    .btn-container>button {
      font-size: 14px;
      position: relative;
      padding: 9px 12px;
      border: none;
      z-index: 1;
      border-radius: 15px;
      margin: 3px 2px 3px 0px;
      box-shadow: inset 0 2px 2px #fff, inset 0 -1px 2px #aeaba4;
      background: #ece7df;
      line-height: 1;
      transition: all 0.15s ease;
    }

    .btn-container>button:first-child {
      margin-left: 4px;
      margin-right: 2px;
    }

    .btn-container>button:last-child {
      margin-left: 0px;
      margin-right: 4px;
    }

    .btn-container>button:only-child {
      margin-left: 4px;
      margin-right: 4px;
    }



    .btn-container>button:hover {
      box-shadow: inset 0 1px 1px #fff, inset 0 -1px 2px #aeaba4, inset 0 0 1px rgba(0, 0, 0, 0.25),
        inset 0 0px 1px rgba(0, 0, 0, 0.25);

    }

    .btn-container>button:active {
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.25), inset 0 5px 10px rgba(0, 0, 0, 0.25), inset 0 2px 2px #ddd,
        inset 0 -1px 2px #9d9b94;
    }

    .btn-container>button:active:after {
      width: 67%;
      height: 67%;
    }

    .btn-container .start-pause-btn {
      padding-left: 48px;
      padding-right: 48px;
    }



    /* Add your styles here */
    .timer {
      display: flex;
      align-items: center;
      gap: 10px;
      background-color: #f9f9f8;
      padding: 10px;
      border-radius: 8px;
    }

    .timer-title {
      font-size: 18px;
      font-weight: bold;
      width: 150px;
      text-align: center;
      border: none;
      background-color: #f0f0f0;
    }

    .timer-value {
      width: 80px;
      font-size: 24px;
      text-align: center;
      border: none;
    }

    button {
      padding: 5px 10px;
      font-size: 16px;
    }



    /* content */


    .dropdown-menu {
      display: none;
      position: absolute;
      background-color: white;
      border: 1px solid #ccc;
      padding: 10px;
    }

    .show-dropdown {
      display: flex;
    }

    .dropdown-item {
      padding: 5px 10px;
      cursor: pointer;
    }

    .dropdown-item:hover {
      background-color: #f0f0f0;
    }






    /* content */

    /* Dropdown Menu Base Styles */
    .dropdown-menu {
      position: absolute;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 10px;
      display: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
      opacity: 0;
      transform: scale(0.9);
    }

    .show-dropdown {
      display: flex;
      opacity: 1;
      left: 25%;
      transform: scale(1);
    }

    /* Main Menu Item Styles */
    .dropdown-item {
      position: relative;
      padding: 10px 20px;
      cursor: pointer;
      background: #f4f4f4;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .dropdown-item:hover {
      background: #4caf50;
      color: #fff;
    }

    /* Submenu Styles */
    .submenu {
      display: none;
      position: absolute;
      /* left: 100%; */
      top: 38px;
      background: #f9f9f9;
      border-radius: 5px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 10px;
      opacity: 0;
      transform: translateX(10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .dropdown-item:hover .submenu {
      display: flex;
      opacity: 1;
      transform: translateX(0);
    }

    /* Submenu Item Styles */
    .submenu-item {
      display: block;
      padding: 8px 16px;
      background: #e0e0e0;
      border-radius: 4px;
      margin: 5px 0;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .submenu-item:hover {
      background: #81c784;
      color: #fff;
    }






    .row {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-top: 20px;
    }

    .col {
      flex: 1;
      padding: 20px;
      background-color: #ffffff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    #contentForm input {
      border-radius: 5px;
      padding: 5px 10px;
    }
  </style>
</head>

<body>
  <div class="config">
    <label>
      <input type="checkbox" id="notifyCheckbox" />
      Enable System Notifications
    </label>
    <br />
    <label class="defaultTimeLabel">
      Default Time:
      <input type="text" id="defaultTime" value="5:00" placeholder="Default Time M:SS" />
    </label>
    <div class="btn-container inline-block">
      <button id="addTimerBtn" title="Add A Timer">‚ûï</button>
    </div>
    <div id="voteData">Total Votes: 0</div>
    <button id="resetVotesBtn" title="Reset Votes">Reset Votes</button>

    <div id="mainTimerContainer" class="timer">
      <input type="text" id="timerTitle" class="timer-title" value="Total Time" oninput="updateTimerTitle()" />
      <input type="text" id="mainTimer" class="timer-value" value="10:00" oninput="updateMainTimerFromInput()" />
      <button id="toggleStartPauseBtn" onclick="toggleStartPause()">‚ñ∂Ô∏è</button>
      <button onclick="resetMainTimer()">üîÑ</button>
    </div>
  </div>

  <div id="timerList">
  </div>

  <div id="contentDisplayContainer">
    <h2>Content Display</h2>
  </div>

  <div id="counterDisplay">
    Individual: <span id="individualCount">0</span> |
    Particular: <span id="particularCount">0</span> |
    Universal: <span id="universalCount">0</span>
  </div>
  <div id="timerList"></div>

  <!-- <div class="websocket-container">
    <h3>Send Message to Server</h3>
    <input type="text" id="messageInput" placeholder="Enter your message..." />
    <button id="sendMessageBtn">Send</button>
  </div> -->


  <!-- <div id="messageDisplay"></div> -->

  <!-- <script src="server2.js"></script> -->
  <!-- <script src="main-timer.js"></script> -->





  <script>
    let mainTimerInterval;
    let mainTimerSeconds = 600;
    let isTimerRunning = false;

    function updateMainTimerDisplay() {
      let minutes = Math.floor(mainTimerSeconds / 60);
      let seconds = mainTimerSeconds % 60;
      document.getElementById("mainTimer").value = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function updateMainTimerFromInput() {
      const input = document.getElementById("mainTimer").value;
      const parts = input.split(":");
      if (parts.length === 2) {
        let mins = parseInt(parts[0], 10);
        let secs = parseInt(parts[1], 10);
        if (!isNaN(mins) && !isNaN(secs) && secs >= 0 && secs < 60) {
          mainTimerSeconds = mins * 60 + secs;
        }
      }
    }

    function updateTimerTitle() {
      const title = document.getElementById("timerTitle").value;

      console.log("Timer title updated to: " + title);
    }

    function toggleStartPause() {
      if (isTimerRunning) {
        clearInterval(mainTimerInterval);
        mainTimerInterval = null;
        isTimerRunning = false;
        document.getElementById("toggleStartPauseBtn").textContent = "‚ñ∂Ô∏è"; // Change button to start icon
      } else {
        startMainTimer();
        document.getElementById("toggleStartPauseBtn").textContent = "‚è∏Ô∏è"; // Change button to pause icon
      }
    }

    function startMainTimer() {
      if (!mainTimerInterval) {
        mainTimerInterval = setInterval(() => {
          if (mainTimerSeconds > 0) {
            mainTimerSeconds--;
            updateMainTimerDisplay();
          } else {
            clearInterval(mainTimerInterval);
            mainTimerInterval = null;
            isTimerRunning = false;
            document.getElementById("toggleStartPauseBtn").textContent = "‚ñ∂"; // Reset button to start
          }
        }, 1000);
        isTimerRunning = true;
      }
    }

    function resetMainTimer() {
      clearInterval(mainTimerInterval);
      mainTimerInterval = null;
      isTimerRunning = false;
      mainTimerSeconds = 600;
      updateMainTimerDisplay();
      document.getElementById("toggleStartPauseBtn").textContent = "‚ñ∂"; // Reset button to start
    }

    updateMainTimerDisplay();
  </script>



  <script>
    const socket = new WebSocket("ws://localhost:8082");

    socket.onopen = function () {
      console.log("Connected to WebSocket server");
    };


    socket.onmessage = function (event) {
      const data = JSON.parse(event.data);
      console.log("Received update:", data);

      // Update UI elements dynamically
      document.getElementById("mainTimer").value = data.mainTimer;
      document.getElementById("voteData").textContent = `Total Votes: ${data.totalVotes}`;
      document.getElementById("individualCount").innerText = data.counters.Individual;
      document.getElementById("particularCount").innerText = data.counters.Particular;
      document.getElementById("universalCount").innerText = data.counters.Universal;
    };

    socket.onclose = function () {
      console.log("Disconnected from WebSocket server. Reconnecting...");
      setTimeout(() => {
        location.reload();
      }, 2000);
    };

    socket.onerror = function (error) {
      console.error("WebSocket Error:", error);
    };

    // Function to send updated timer data to WebSocket server
    function sendTimerUpdate() {
      socket.send(JSON.stringify("inside of send find update"));

      const updatedData = {
        mainTimer: document.getElementById("mainTimer").value,
        totalVotes: parseInt(document.getElementById("voteData").textContent.replace(/\D/g, ""), 10),
        counters: {
          Individual: parseInt(document.getElementById("individualCount").innerText, 10),
          Particular: parseInt(document.getElementById("particularCount").innerText, 10),
          Universal: parseInt(document.getElementById("universalCount").innerText, 10),
        },
      };
      socket.send(JSON.stringify(updatedData));
    }

    // Attach event listener to timer input field
    document.getElementById("mainTimer").addEventListener("input", sendTimerUpdate);

    // Attach event listener to vote reset button
    document.getElementById("resetVotesBtn").addEventListener("click", () => {
      document.getElementById("voteData").textContent = "Total Votes: 0";
      // socket.send(JSON.stringify("does it reatch timer"));

      sendTimerUpdate();
      socket.send(JSON.stringify("nabin"));

    });


  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const timerList = document.getElementById("timerList");
      const addTimerBtn = document.getElementById("addTimerBtn");
      const defaultTimeInput = document.getElementById("defaultTime");
      const notifyCheckbox = document.getElementById("notifyCheckbox");
      const voteDataDiv = document.getElementById("voteData"); // Total vote display

      const contentDisplayContainer = document.getElementById("contentDisplayContainer");

      const counters = {
        Individual: 0,
        Particular: 0,
        Universal: 0
      };

      let totalVotes = 0; // Global vote count to track total votes
      let currentRunningTimer = null; // Track the currently running timer

      addTimerBtn.style.color = "green"; // Optional: Set the color to green


      function updateCounterDisplay() {
        document.getElementById("individualCount").innerText = counters.Individual;
        document.getElementById("particularCount").innerText = counters.Particular;
        document.getElementById("universalCount").innerText = counters.Universal;
      }

      addTimerBtn.addEventListener("click", addTimer);


      notifyCheckbox.addEventListener("change", function () {
        if (this.checked) {
          requestNotificationPermission();
        }
      });

      addTimerBtn.addEventListener("click", addTimer);
      resetVotesBtn.addEventListener("click", resetVotes); // Add listener for reset vote button

      function createTimerComponent(defaultTime) {
        const timerComponent = document.createElement("div");
        timerComponent.className = "timer";
        timerComponent.flow = "flow timer default";
        timerComponent.content = "content timer default";
        timerComponent.people = "people timer default";
        timerComponent.votesubmit = "votesubmit timer default";


        timerComponent.innerHTML = `
        <input type="text" placeholder="Timer Title" class="timer-title"/>
              <input type="text" value="${defaultTime}" class="timer-value"/>
  
        <div class="flex-row">
          <button class="start-pause-btn">‚ñ∂Ô∏è</button>
          <button class="reset-initial-btn">‚èèÔ∏è</button>
          <button class="reset-default-btn">‚§µÔ∏è</button>
          <button class="remove-btn">‚ùå</button>
          <button class="form-btn" id="formbtn">Form</button>
          <button class="content-btn">Content</button>
          <button class="people-btn">People</button>
          <button class="vote-btn">Vote</button>
        </div>
      `;
        timerList.appendChild(timerComponent);

        // Create dropdown menu inside content-btn
        const contentBtn = timerComponent.querySelector(".content-btn");
        const dropdownMenu = document.createElement("div");
        dropdownMenu.classList.add("dropdown-menu");
        dropdownMenu.innerHTML = `
            <button class="dropdown-item" data-type="Individual">Individual</button>
            <button class="dropdown-item" data-type="Particular">Particular</button>
            <button class="dropdown-item" data-type="Universal">Universal</button>
          `;

        // confisuan
        timerComponent.appendChild(dropdownMenu);



        let assignedCategories = new Set();

        contentBtn.addEventListener("click", () => {
          dropdownMenu.classList.toggle("show-dropdown");
        });

        dropdownMenu.addEventListener("click", (e) => {
          const selectedContent = e.target.dataset.type;
          openContentForm(selectedContent, timerComponent, assignedCategories);
        });



        document.addEventListener("click", (event) => {
          if (!contentBtn.contains(event.target) && !dropdownMenu.contains(event.target)) {
            dropdownMenu.classList.remove("show-dropdown");
          }
        });

        // Create dropdown menu inside form-btn
        const formBtn = timerComponent.querySelector(".form-btn");
        const formDropdownMenu = document.createElement("div");
        formDropdownMenu.classList.add("dropdown-menu");

        // Create Main Menu Items
        formDropdownMenu.innerHTML = `
        <div class="dropdown-item" id="turnbutton">1. Turn
          <div class="submenu">
            <button class="submenu-item" id="straightturn">Straight Turn</button>
            <button class="submenu-item" id="directiveTurn">Directive Turn</button>
            <button class="submenu-item" id="popcornTurn">Popcorn Turn</button>
          </div>
        </div>
        <div class="dropdown-item" id="freeflowbutton">2. Free Flow
          <div class="submenu">
            <button class="submenu-item">Fast Free Flow</button>
            <button class="submenu-item">Team Free Flow</button>
            <button class="submenu-item">Spread Free Flow</button>
          </div>
        </div>
        <div class="dropdown-item" id="godmodebutton">3. God Mode
          <div class="submenu">
            <button class="submenu-item">Same People</button>
            <button class="submenu-item">Remove People</button>
            <button class="submenu-item">Add People</button>
          </div>
        </div>
      `;
        formBtn.appendChild(formDropdownMenu);

        // Toggle dropdown visibility
        formBtn.addEventListener("click", () => {
          formDropdownMenu.classList.toggle("show-dropdown");
        });
        

        document.addEventListener("click", (event) => {
          if (!formBtn.contains(event.target) && !formDropdownMenu.contains(event.target)) {
            formDropdownMenu.classList.remove("show-dropdown");
          }
        });



        document.getElementById("straightturn").addEventListener("click", () => {
          console.log("Straight Turn clicked");
                    formbtn.style.backgroundColor = "green";

          // socket.send(JSON.stringify("straight turn"));
          turnbutton.style.backgroundColor = "green"; // Green color for voted button
          straightturn.style.backgroundColor = "green"; // Green color for voted button

          timerComponent.flow = "straight time";
        });


        document.getElementById("directiveTurn").addEventListener("click", () => {
          console.log("Directive Turn clicked");
          formbtn.style.backgroundColor = "green";

          turnbutton.style.backgroundColor = "green"; // Green color for voted button
          directiveTurn.style.backgroundColor = "green"; // Green color for voted button
          timerComponent.flow = "directive  time";

        });





        document.getElementById("popcornTurn").addEventListener("click", () => {
          console.log("Popcorn Turn clicked");
          formbtn.style.backgroundColor = "green";
          turnbutton.style.backgroundColor = "green";
          popcornTurn.style.backgroundColor = "green";

          socket.send(JSON.stringify("Popcorn turn"));

        });








        return timerComponent;
      }



      function openContentForm(contentType, timerComponent, assignedCategories) {
        const existingForm = document.getElementById("contentForm");
        if (existingForm) {
          existingForm.remove();
        }

        const formHTML = `
        <div id="contentForm">
          <input type="text" id="topicName" placeholder="Enter Topic Name"/>
          <input type="text" id="topicTime" value="2:00" placeholder="Enter Time (e.g., 2 min)"/>
          <button id="submitContentBtn">Submit</button>
        </div>
      `;

        const contentForm = document.createElement("div");
        contentForm.innerHTML = formHTML;
        document.body.appendChild(contentForm);

        const submitContentBtn = contentForm.querySelector("#submitContentBtn");
        submitContentBtn.addEventListener("click", () => {
          const topicName = document.getElementById("topicName").value;
          const topicTime = document.getElementById("topicTime").value;

          if (topicName && topicTime) {
            addContentSection(contentType, topicName, topicTime);
            assignedCategories.add(contentType);
            counters[contentType]++;
            updateCounterDisplay();
            contentForm.remove();
          }
        });
      }






      function addContentSection(type, title, time) {
        const contentSection = document.createElement("div");
        contentSection.className = "content-section";

        let timerRunning = false;
        let timerInterval;
        let currentTime = time; // Save the original time for later use

        contentSection.innerHTML = `
        <strong>${type}:</strong> ${title} - Time: <span class="time-display" contenteditable="true">${time}</span>
        <button class="remove-content-btn">‚ùå</button>
        <button class="play-pause-btn">‚ñ∂Ô∏è</button>
      `;

        contentDisplayContainer.appendChild(contentSection);

        const removeContentBtn = contentSection.querySelector(".remove-content-btn");
        removeContentBtn.addEventListener("click", () => {
          contentSection.remove();
          counters[type]--;
          updateCounterDisplay();
        });

        const playPauseBtn = contentSection.querySelector(".play-pause-btn");
        const timeDisplay = contentSection.querySelector(".time-display");

        playPauseBtn.addEventListener("click", () => {
          if (timerRunning) {
            clearInterval(timerInterval);
            playPauseBtn.innerText = "‚ñ∂Ô∏è";
          } else {
            // When starting, get the time from the contenteditable element
            let editedTime = timeDisplay.innerText;
            let [minutes, seconds] = editedTime.split(":").map(Number);

            timerInterval = setInterval(() => {
              if (seconds > 0) {
                seconds--;
              } else if (minutes > 0) {
                minutes--;
                seconds = 59;
              } else {
                clearInterval(timerInterval);
              }
              editedTime = `${minutes}:${seconds < 10 ? "0" + seconds : seconds}`;
              timeDisplay.innerText = editedTime;
            }, 1000);
            playPauseBtn.innerText = "‚è∏Ô∏è";
          }
          timerRunning = !timerRunning;
        });
      }

      function addTimer() {
        const defaultTime = defaultTimeInput.value;
        const timerComponent = createTimerComponent(defaultTime);
        setupTimerControls(timerComponent, defaultTime);
      }




      function setupTimerControls(timerComponent, initialTime) {
        const timerTitle = timerComponent.querySelector(".timer-title");
        const timerValue = timerComponent.querySelector(".timer-value");
        const startPauseBtn = timerComponent.querySelector(".start-pause-btn");
        const resetInitialBtn = timerComponent.querySelector(".reset-initial-btn");
        const resetDefaultBtn = timerComponent.querySelector(".reset-default-btn");
        const removeBtn = timerComponent.querySelector(".remove-btn");
        let intervalId = null;
        let wasRunning = false;

        // Vote button functionality
        const voteBtn = timerComponent.querySelector(".vote-btn");
        let hasVoted = false; // Track if this timer has already voted

        voteBtn.addEventListener("click", () => {
          if (!hasVoted) {
            totalVotes++; // Increment total vote count
            hasVoted = true; // Mark this timer as voted
            voteDataDiv.textContent = `Total Votes: ${totalVotes}`; // Update the total votes displayed

            // Change button text and color to unvote for subsequent clicks
            voteBtn.textContent = "Unvote"; // Change text to Unvote
            voteBtn.style.backgroundColor = "green"; // Green color for voted button
          } else {
            totalVotes--; // Decrement total vote count
            hasVoted = false; // Mark this timer as unvoted
            voteDataDiv.textContent = `Total Votes: ${totalVotes}`; // Update the total votes displayed

            // Change button text and color to vote again
            voteBtn.textContent = "Vote"; // Change text to Vote
            voteBtn.style.backgroundColor = ""; // Reset button color to default
          }
        });

        function toggleTimer(shouldStart) {
          if (shouldStart) {
            if (currentRunningTimer && currentRunningTimer !== timerComponent) {
              currentRunningTimer.querySelector(".start-pause-btn").click(); // Stop the other timer
            }
            startTimer();
          } else {
            clearInterval(intervalId);
            intervalId = null;
            startPauseBtn.textContent = "‚ñ∂Ô∏è";
            timerComponent.style.backgroundColor = ""; // Reset background color to default
          }
        }

        function startTimer() {
          // Clear background color when timer starts
          timerComponent.style.backgroundColor = "#c5eba9"; // Turn bg color to light green

          let [minutes, seconds] = timerValue.value.split(":").map(num => parseInt(num, 10));
          let totalSeconds = minutes * 60 + seconds;

          intervalId = setInterval(() => {
            if (totalSeconds <= 0) {
              clearInterval(intervalId);
              intervalId = null;
              timerComponent.style.backgroundColor = "orange";
              onComplete();
              startPauseBtn.textContent = "‚ñ∂Ô∏è";
              return;
            }
            totalSeconds--;

            const mins = Math.floor(totalSeconds / 60).toString();
            const secs = (totalSeconds % 60).toString().padStart(2, "0");
            timerValue.value = `${mins}:${secs}`;
          }, 1000);

          currentRunningTimer = timerComponent; // Set the current running timer
          startPauseBtn.textContent = "‚è∏Ô∏è";
        }

        timerValue.addEventListener("focus", () => {
          if (intervalId !== null) {
            wasRunning = true;
            toggleTimer(false);
          }
        });

        timerValue.addEventListener("blur", () => {
          if (wasRunning) {
            toggleTimer(true);
            wasRunning = false; // Reset the flag
          }
        });

        startPauseBtn.addEventListener("click", () => {
          if (intervalId === null) {
            toggleTimer(true);
          } else {
            toggleTimer(false);
          }
        });

        resetDefaultBtn.addEventListener("click", () => {
          clearInterval(intervalId);
          intervalId = null;
          timerValue.value = defaultTimeInput.value; // Reset to the current default time
          timerComponent.style.backgroundColor = ""; // Remove background color
          startPauseBtn.textContent = "‚ñ∂Ô∏è";
        });

        resetInitialBtn.addEventListener("click", () => {
          clearInterval(intervalId);
          intervalId = null;
          timerValue.value = initialTime; // Reset to the initial time
          timerComponent.style.backgroundColor = ""; // Remove background color
          startPauseBtn.textContent = "‚ñ∂Ô∏è";
        });

        removeBtn.addEventListener("click", () => {
          clearInterval(intervalId);
          timerComponent.remove();
          if (currentRunningTimer === timerComponent) {
            currentRunningTimer = null; // Reset if this was the running timer
          }
        });

        function playSound() {
          const audio = new Audio("complete.mp3"); // Correct path to the sound file
          audio.play();
        }

        function onComplete() {
          playSound();
          // Check if system notifications are enabled and send a notification
          if (notifyCheckbox.checked) {
            sendSystemNotification(`${timerTitle.value || "Timer"} Completed`, {
              body: `Your ${timerTitle.value ? timerTitle.value + " " : ""}timer has finished.`,
            });
          }
        }
      }

      function requestNotificationPermission() {
        if ("Notification" in window) {
          Notification.requestPermission().then(permission => {
            if (permission === "granted") {
              console.log("Notification permission granted.");
            }
          });
        }
      }

      function sendSystemNotification(title, options) {
        if ("Notification" in window && Notification.permission === "granted") {
          new Notification(title, options);
        } else if (Notification.permission === "denied") {
          Notification.requestPermission().then(permission => {
            if (permission === "granted") {
              new Notification(title, options);
            }
          });
        }
      }

      function resetVotes() {
        totalVotes = 0; // Reset the vote count to 0
        voteDataDiv.textContent = `Total Votes: ${totalVotes}`; // Update the display
        // Reset all vote buttons' color to default (no vote)
        const voteBtns = document.querySelectorAll(".vote-btn");
        voteBtns.forEach(voteBtn => {
          voteBtn.style.backgroundColor = ""; // Remove background color
          voteBtn.disabled = false; // Enable voting again
        });
      }



      function getTimersAsJson() {
        const timers = [];

        document.querySelectorAll(".timer").forEach(timerComponent => {
          const title = timerComponent.querySelector(".timer-title")?.value || "Untitled";
          const timeValue = timerComponent.querySelector(".timer-value")?.value || "00:00";
          const voteBtn = timerComponent.querySelector(".vote-btn");
          const hasVoted = voteBtn && voteBtn.textContent === "Unvote"; // Check if voted
          const assignedCategories = [...timerComponent.querySelectorAll(".dropdown-item.active")]
            .map(btn => btn.dataset.type); // Categories assigned

          timers.push({
            title: title,
            time: timeValue,
            voted: hasVoted,
            categories: assignedCategories.length > 0 ? assignedCategories : ["None"]
          });
        });

        const jsonOutput = JSON.stringify(timers, null, 2);
        console.log(jsonOutput); // Display in console
        return jsonOutput;
      }

      document.getElementById("jsonOutput").textContent = getTimersAsJson();







    });





    function getTimersAsJson() {
      const timers = [];

      document.querySelectorAll(".timer").forEach(timerComponent => {
        const title = timerComponent.querySelector(".timer-title")?.value || "Untitled";
        const timeValue = timerComponent.querySelector(".timer-value")?.value || "00:00";
        const voteBtn = timerComponent.querySelector(".vote-btn");
        const hasVoted = voteBtn && voteBtn.textContent === "Unvote"; // Check if voted
        const assignedCategories = [...timerComponent.querySelectorAll(".dropdown-item.active")]
          .map(btn => btn.dataset.type); // Categories assigned

        timers.push({
          title: title,
          time: timeValue,
          voted: hasVoted,
          categories: assignedCategories.length > 0 ? assignedCategories : ["None"]
        });
      });

      const jsonOutput = JSON.stringify(timers, null, 2);
      console.log(jsonOutput); // Display in console
      return jsonOutput;
    }

    document.getElementById("jsonOutput").textContent = getTimersAsJson();

  </script>
</body>

</html>